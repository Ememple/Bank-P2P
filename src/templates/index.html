<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Bank System</title>
    <link rel="stylesheet" type="text/css" media="screen" href="/static/stylesheet.css">
</head>

<body>
<header>
    <h1>Bank<span>Management System</span></h1>
</header>
<main>
    <button id="stop_server_btn" class="button" style="background: #570d00">Stop server</button>

    <table id="table">
        <tr id="header" style="background: #333333; color: white;">
            <th>Account ID</th>
            <th>Balance</th>
        </tr>
    </table>

    <script>
        document.getElementById("stop_server_btn").onclick = async () => {
            if (!confirm("This will shut down the entire Bank.\n\nAre you sure?")) {
                return;
            }

            try {
                fetch("/shutdown", { method: "POST" });
            } catch (error) {
                console.log("Server shutdown");
            }

            document.body.innerHTML = `
                <div style="text-align: center; margin-top: 50px;">
                    <h1>SERVER STOPPED</h1>
                    <p>The application has been shut down.</p>
                </div>
            `;
        }

        const header = document.getElementById("header")
        const table = document.getElementById("table")

        function createRow(account) {
            let row = document.createElement("tr");
            table.appendChild(row);

            let idCol = row.appendChild(document.createElement("td"));
            idCol.textContent = account.id;

            let balCol = row.appendChild(document.createElement("td"));
            balCol.textContent = account.balance + " CZK";
        }


        async function refreshData() {
            try {
                const response = await fetch('/api/accounts');
                if (!response.ok) throw new Error("Server not responding");

                const accounts = await response.json();
                const existingRows = document.querySelectorAll("tr:not(#header)");
                existingRows.forEach(row => row.remove());

                let totalBalance = 0;
                let totalAccounts = 0;

                accounts.forEach(acc => {
                    createRow(acc);
                    totalBalance += acc.balance;
                    totalAccounts++;
                });

                let summaryRow = document.createElement("tr");
                summaryRow.style.fontWeight = "bold";
                summaryRow.style.backgroundColor = "#333333";
                summaryRow.style.color = "white";
                summaryRow.style.borderTop = "2px solid #555";

                let countCol = document.createElement("td");
                countCol.textContent = "Total Clients: " + totalAccounts;
                summaryRow.appendChild(countCol);

                let totalCol = document.createElement("td");
                totalCol.textContent = "Total: " + totalBalance + " CZK";
                summaryRow.appendChild(totalCol);

                table.appendChild(summaryRow);

            } catch (error) {
                console.error("Error fetching data (Server might be down):", error);
            }
        }

        refreshData();
        setInterval(refreshData, 2000);

    </script>
</main>
<footer>
    <a href="https://github.com/Ememple/Bank-P2P/tree/main">Â© 2026 P2P-Bank</a>
</footer>
</body>
</html>